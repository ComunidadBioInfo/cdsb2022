[["index.html", "Workshop CDSB 2022: Análisis avanzado de metagenomas. Creando tus flujos de análisis con R/Bioconductor. Bienvenida 0.1 Instructores 0.2 Ponentes invitados 0.3 Ayudantes 0.4 Temario 0.5 Patrocinadores 0.6 Licencia", " Workshop CDSB 2022: Análisis avanzado de metagenomas. Creando tus flujos de análisis con R/Bioconductor. Dra. Mirna Vázquez Rosas-Landa, Dra. Yalbi Balderas-Martínez, Dra. Joselyn Chávez, M.C. Erick Cuevas-Fernández, Dra. Alejandra Medina-Rivera, Dr. Leonardo Collado-Torres, Dr. Brett Baker, Dra. Valerie de Anda Bienvenida Les damos la bienvenida al Workshop Análisis avanzado de metagenomas. Creando tus flujos de análisis con R/Bioconductor! En los últimos años la metagenómica ha cobrado una gran importancia para el descubrimiento de nuevos grupos microorganismos y rutas metabólicas. En este taller revisaremos los métodos más recientes para analizar datos metagenómicos, usando herramientas de software libre y paquetes de R especializados que están disponibles libremente vía Bioconductor. Durante este taller aprenderás a reconstruir genomas a partir de metagenomas utilizando diferentes herramientas de software libre. Revisaremos diferentes estrategias de binning y de predicción metabólica, identificaremos áreas de oportunidad para el desarrollo de software en metagenómica, aprenderás también cómo documentar tu código utilizando RMarkdown. 0.1 Instructores Dra. Mirna Vázquez Rosas Landa: Estancia Postdoctoral en la Universidad de Texas en Austin. Dra. Yalbi Balderas Martínez: Investigadora en el Instituto Nacional de Enfermedades Respiratorias Ismael Cosío Villegas. Dra. Joselyn Chávez Fuentes: Estancia Postdoctoral en Icahn School of Medicine at Mount Sinai. M.C. Erick Cuevas Fernández: Estudiante de Doctorado en la Universidad Nacional Autónoma de México. Dra. Alejandra Medina Rivera: Investigadora Asociada en el Laboratorio Internacional de Investigación de Medicina Genómica, UNAM. 0.2 Ponentes invitados Dr. Brett Baker: Investigador en la Universidad de Texas en Austin. Dra. Valerie de Anda: Investigadora Asociada en la Universidad de Texas en Austin. Dr. Leonardo Collado-Torres 0.3 Ayudantes M.C. Diana Oaxaca M.C. Marisol Navarro M.C. José Antonio Ovando 0.4 Temario Consulta el calendario de este curso en: https://bit.ly/calendarcdsb2022 0.4.1 Lunes 01 de agosto Horario Tema Instructor 09:00-09:30 Bienvenida. Comité organizador EBM 2022 09:30-10:30 Presentación de la CDSB. Comité organizador CDSB 2022 11:00-12:00 Plática: La última versión del árbol de la vida y la metagenómica. Dr. Brett Baker 12:00-14:00 Control de versiones con GitHub y RStudio. Dra. Alejandra Medina 15:00-17:00 Generación de Reportes con R markdown. M.C Erick Cuevas Fernández y Dra. Joselyn Chávez 0.4.2 Martes 02 de agosto Horario Tema Instructor 9:00-10:00 Plática: Convirtiendo tu flujo de análisis en un paquete de R/Bioconductor. Dr. Leonardo Collado Torres 10:00-11:00 Introducción a Conda Por definir 11:30-13:00 Reconstrucción de genomas. Parte I Binning M.C. Diana Oaxaca y Dra. Mirna Vazquez Rosas Landa 13:00-14:00 Plática: Paquetes de bioconductor relacionados con la metagenómica. Dra. Yalbi Balderas 15:00-17:00 Reconstrucción de genomas. Parte II Dra. Yalbi Balderas 0.4.3 Miércoles 03 de agosto Horario Tema Instructor 9:00-10:30 Asignación taxonómica. Dra. Mirna Vázquez 11:30-13:30 Análisis de vías metabólicas. Parte I Dra. Mirna Vázquez y Dra. Yalbi Balderas 15:00-17:00 Análisis de vías metabólicas. Parte II Dra. Mirna Vázquez y Dra. Yalbi Balderas 0.4.4 Jueves 04 de agosto Horario Tema Instructor 9:00-11:00 MEBs. Dra. Valerie de Anda 11:30-14:00 Proyecto colaborativo. Parte I Dra. Mirna Vázquez, Dra. Yalbi Balderas, Dra. Joselyn Chávez, M.C. Erick Cuevas 15:00-17:00 Proyecto colaborativo. Parte II Dra. Mirna Vázquez, Dra. Yalbi Balderas, Dra. Joselyn Chávez, M.C. Erick Cuevas 0.4.5 Viernes 05 de agosto Horario Tema Instructor 9:00-11:00 Proyecto colaborativo Parte III Dra. Mirna Vázquez, Dra. Yalbi Balderas, Dra. Joselyn Chávez, Dra. Erick Cuevas 11:30-13:30 Presentación de proyectos Dra. Mirna Vázquez, Dra. Yalbi Balderas, Dra. Joselyn Chávez, Dra. Erick Cuevas 13:30-14:00 Clausura Organizadores CDSB 2022 0.5 Patrocinadores Agradecemos a nuestros patrocinadores: 0.6 Licencia Este material posee una licencia tipo Creative Commons Attribution-ShareAlike 4.0 International License. Para conocer más sobre esta licencia, visite http://creativecommons.org/licenses/by-sa/4.0/ "],["keynote-la-última-versión-del-árbol-de-la-vida-y-la-metagenómica.html", "1 Keynote: La última versión del árbol de la vida y la metagenómica 1.1 Diapositivas", " 1 Keynote: La última versión del árbol de la vida y la metagenómica Dr. Brett Baker 01 de agosto de 2022 1.1 Diapositivas "],["control-de-versiones-con-github-y-rstudio..html", "2 Control de versiones con GitHub y RStudio.", " 2 Control de versiones con GitHub y RStudio. Dra. Alejandra Medina 01 de agosto de 2022 "],["generación-de-reportes-con-r-markdown..html", "3 Generación de Reportes con R markdown.", " 3 Generación de Reportes con R markdown. M.C Erick Cuevas Fernández y Dra. Joselyn Chávez 01 de agosto de 2022 "],["keynote-convirtiendo-tu-flujo-de-análisis-en-un-paquete-de-rbioconductor..html", "4 Keynote: Convirtiendo tu flujo de análisis en un paquete de R/Bioconductor.", " 4 Keynote: Convirtiendo tu flujo de análisis en un paquete de R/Bioconductor. Dr. Leonardo Collado Torres 02 de agosto de 2022 "],["introducción-a-conda..html", "5 Introducción a Conda.", " 5 Introducción a Conda. Por definir 02 de agosto de 2022 "],["el-grupo-de-datos.html", "6 El grupo de datos", " 6 El grupo de datos M.C. Diana Oaxaca y Dra. Mirna Vazquez Rosas Landa 02 de agosto de 2022 6.0.1 Datos Los datos con los que trabajaremos se enlistan en la siguiente tabla. samples BioProject Article htn PRJEB13870 Gut microbiota dysbiosis contributes to … biogas PRJEB21678 Genetic repertoires of anaerobic microbiomes …. pulque PRJNA603591 Genomic profiling of bacterial and fungal … sedimento PRJNA364776 Microbial Dark Matter project phase II * tea PRJNA698063 Niche differentiation of microbes……) 6.0.1.1 htn Sinopsis: Se realizó secuenciación metagenómica de heces de pacientes sanos (control), con pre-hipertensión (pHTN) y con hipertensión (HTN). Los pacientes con enfermedad presentaron niveles de diversidad drásticamente más bajos en comparación con el grupo control. También hicieron trasplantes fecales de pacientes enfermos a ratones axénicos, el efecto del trasplante demostró que la hipertensión observada en los ratones era derivada de la microbiota trasplantada. Los datos crudos: PRJEB13870 https://www.ebi.ac.uk/ena/browser/view/PRJEB13870?show=reads El artículo: Gut microbiota dysbiosis contributes to the development of hypertension sobre microbioma e hipertensión https://link.springer.com/article/10.1186/s40168-016-0222-x#Ack1 Li, J., Zhao, F., Wang, Y. et al. Gut microbiota dysbiosis contributes to the development of hypertension. Microbiome 5, 14 (2017). https://doi.org/10.1186/s40168-016-0222-x 6.0.1.2 pulque. Sinopsis: En este trabajo se secuenciaron librerias de Illumina MiSeq de muestras a diferentes tiempos de fermentación: 0 hrs (aguamiel), 3, 6 y 12 horas. En general observaron que la abundancia de los géneros cambió durante la fermentación y se asoció con una disminución de sacarosa, aumento de etanol y ácido láctico (Medidos por HPLC). Predijeron, entre otros, la biosíntesis de folato y vitamina B. Uno de los MAG obtenidos correspondió a Saccharomyces cereviseae relacionado filogenéticamente con S. cerevisiae aislado de sake y bioetanol y otro correspondió a Zymomonas mobilis que propusieron como un nuevo linaje. Los datos crudos: PRJNA603591 https://www.ebi.ac.uk/ena/browser/view/PRJNA603591 El articulo: Genomic profiling of bacterial and fungal communities and their predictive functionality during pulque fermentation by whole-genome shotgun sequencing https://www.nature.com/articles/s41598-020-71864-4 Chacón-Vargas, K., Torres, J., Giles-Gómez, M. et al. Genomic profiling of bacterial and fungal communities and their predictive functionality during pulque fermentation by whole-genome shotgun sequencing. Sci Rep 10, 15115 (2020). https://doi.org/10.1038/s41598-020-71864-4 6.0.1.3 sedimento Microbioma de sedimento del Microbial Dark Matter project (MDMP) Sinopsis: El MDMP es realizado por el Departamento de Energía del JGI, se enfoca en resolver nuevos superphyla de bacterias y arqueas, en la fase uno se secuenciaron 201 linajes enriquecidos no cultivados, mediante single cell sequencing. En esta segunda fase se utilizaron datos públicos de diferentes muestras y regiones del mundo. Aún se siguen procesando datos y hasta el momento han encontrado prometedores SAGs incluído un phylum novedoso en Deward Creek. Los datos: PRJNA364776 https://www.ebi.ac.uk/ena/browser/view/PRJNA364776 El proyecto: Microbial Dark Matter project phaseII https://www.osti.gov/award-doi-service/biblio/10.46936/10.25585/60000876 Hedlund, Brian ORCID [1] Woyke, Tanja ORCID [2] Pester, Michael ORCID [3] Spear, John ORCID [4] Hallam, Steven ORCID [5] Eisen, Jonathan [6] Elshahed, Mostafa ORCID [7] Becraft, Eric [8] Dunfield, Peter [9] Teske, Andreas [10] van Heerden, et al. Joint Genome Institute Award. 6.0.1.4 tea Microbioma de Camellia sinensis (la planta del té verde y negro) Sinopsis: En este trabajo se secuenciaron librerias de Illumina de muestras rizosféricas y endofíticas de C. sinensis, el estudio hace una descripción general de la taxonomía y predicción funcional del microbioma, hace énfasis en las diferencias encontradas en la parte endofítica y rizosféricas. Los datos: PRJNA698063 https://www.ebi.ac.uk/ena/browser/view/PRJNA698063 El artículo: Niche differentiation of microbes and their functional signatures in Assam type tea (Camellia sinensis var. assamica) https://www.researchsquare.com/article/rs-347764/v1 Bora, S. S., Dey, K. K., Borah, M., Rahman, M., Gogoi, M., Modi, M. K., &amp; Barooah, M. (2021). Niche differentiation of microbes and their functional signatures in Assam type tea (Camellia sinensis var. assamica). "],["mapeo-y-binning.html", "7 Mapeo y Binning 7.1 Mapeo 7.2 Binning 7.3 Refinamiento", " 7 Mapeo y Binning M.C. Diana Oaxaca y Dra. Mirna Vazquez Rosas Landa 02 de agosto de 2022 7.1 Mapeo Profundidad: La profundidad de cada contig se calcula mapeando las lecturas al ensamble. Este paso permite evaluar la calidad del ensable y es necesario para hacer la reconstrucción de genomas ya que, como veremos más adelante, es uno de los parámetros que toman en cuenta los “bineadores”. Vamos a mapear utilizando la herramienta BBMap del programa BBtools. Y samtools. ¡Manos a la obra! Conéctate al servidor: ssh USER@hpc-matematicas-z.fciencias.unam.mx Crea tu carpeta y una liga simbólica a los datos: mkdir -p 01.Mapeo/{data,results} cd 01.Mapeo/ ln -s /home/diana/samples/htn/data/htn.fasta data/ ln -s /home/mirna/03.Mapeo/01.Trimm_reads/htn*.fastq data/ Primero que nada activa tu ambiente de conda. conda activate bbmap_env Ahora ¡sí! explora las opciones de bbmap, y vamos a hacer nuestro primer mapeo. bbmap.sh ref=data/htn.fasta in1=data/htn_1-short.fastq in2=data/htn_2-short.fastq out=results/htn.sam kfilter=22 subfilter=15 maxindel=80 cd results samtools view -bShu htn.sam | samtools sort -@ 94 -o htn_sorted.bam samtools index htn_sorted.bam 7.1.1 Discutamos https://docs.google.com/document/d/1iiw-q-90nATg-RNTd9nU8L1XE5xoDRC6j19JC1GiPIk/edit?usp=sharing 7.2 Binning Utilizaremos varios programas para hacer la reconstrucción de los genomas y haremos una comparación de estos. NOTA: Cada programa tiene una ayuda y un manual de usuario, es importante revisarlo y conocer cada parámetro que se ejecute. En terminal se puede consultar el manual con el comando man y también se puede consultar la ayuda con -h o --help, por ejemplo fastqc -h. La presente práctica sólo es una representación del flujo de trabajo, sin embargo, no sustituye los manuales de cada programa y el flujo puede variar dependiendo del tipo de datos y pregunta de investigación. 7.2.1 MaxBin Crea tu espacio de trabajo y una liga símbólica hacia los datos que se usarán: mkdir -p 02.MaxBin/{data,results} cd 02.MaxBin/ ln -s /home/diana/samples/htn/data/htn.fasta data/ ln -s /home/diana/samples/htn/data/htn-depth.txt data/ Okay, ahora activa tu ambiente. conda activate maxbin_env Explora las opciones y ahora si, a calcular bins. run_MaxBin.pl -contig data/htn.fasta -out results/maxbin -abund data/htn-depth.txt -max_iteration 2 7.2.2 MetaBat Okay vamos a utilizar otro progama. Crea tus ligas simbolicas :) mkdir -p 03.Metabat/{data,results} cd 03.Metabat/ ln -s /home/diana/samples/htn/data/htn.fasta data/ ln -s /home/diana/samples/htn/data/htn_sorted.bam data/ Para MetaBat lo primero que tenemos que hacer es crear un archivo de profundidad utilizando el script jgi_summarize_bam_contig_depths. Entonces primero activamos el ambiente. conda activate metabat_env Como cualquier otro programa jgi_summarize_bam_contig_depths tiene opciones, podemos revisarlas. jgi_summarize_bam_contig_depths --outputDepth data/htn-depth.txt data/htn_sorted.bam Okay… exploremos el archivo con head head data/htn-depth.txt Para metabat solo necesitamos dos archivos principales: El ensamble El archivo de profundidad metabat -i data/htn.fasta -a data/htn-depth.txt -o results/bins -t 4 --minCVSum 0 --saveCls -d -v --minCV 0.1 -m 2000 7.2.3 CONCOCT Okay vamos a utilizar otro programa. Crea tus ligas simbolicas :) mkdir -p 04.Concoct/{data,results} cd 04.Concoct/ ln -s /home/diana/samples/htn/data/htn.fasta data/ ln -s /home/diana/samples/htn/data/htn_sorted.bam data/ Primero activemos el ambiente conda activate concoct_env Primero los contigs se tienen que partir en pedazos mas pequeños cut_up_fasta.py data/htn.fasta -c 10000 -o 0 --merge_last -b results/SplitAssembly-htn.bed &gt; results/htn.fasta-split10K.fa Para crear la tabla de cobertura se necesita primero indexar el archivo bam samtools index data/htn_sorted.bam concoct_coverage_table.py results/SplitAssembly-htn.bed data/htn_sorted.bam &gt; results/concoct_coverage_table_htn.tsv Ahora si!! a correr concoct. Normalmente correriamos 500 iteraciones, pero esta vez solo haremos una. concoct --coverage_file results/concoct_coverage_table_htn.tsv --composition_file results/htn.fasta-split10K.fa --clusters 400 --kmer_length 4 --threads 4 --length_threshold 3000 --basename concot --seed 4 --iterations 1 Combinar contigs merge_cutup_clustering.py concot_clustering_gt3000.csv &gt; results/merged-htn-gt3000.csv Extraer bins como fasta individualmente mkdir results/bins-concot extract_fasta_bins.py data/htn.fasta results/merged-htn-gt3000.csv --output_path results/bins-concot 7.2.4 Discutamos https://docs.google.com/document/d/1iiw-q-90nATg-RNTd9nU8L1XE5xoDRC6j19JC1GiPIk/edit?usp=sharing 7.3 Refinamiento 7.3.1 DASTool Preparing input files. Fasta_to_Scaffolds2Bin.sh -i /home/mirna/05.Concoct/bins-concot -e fa &gt; htn_concot.scaffolds2bin.tsv Fasta_to_Scaffolds2Bin.sh -i /home/mirna/04.Metabat2 -e fa &gt; htn.scaffolds2bin.tsv PATH=/home/programs:$PATH /home/programs/DAS_Tool-1.1.2/DAS_Tool -i htn_maxbin.contigs2bin.tsv,htn_metabat.scaffolds2bin.tsv,htn_concoct.scaffolds2bin.tsv -l maxbin,metabat,concoct -c data/htn.fasta -o results/htn_bins --debug -t 4 --search_engine diamond --write_bins 1 7.3.2 CheckM Muy bien, crea un nuevo directorio y entra en él. mkdir 06.CheckM cd 06.CheckM/ Ahora activemos el ambiente. conda activate checkm_env checkm lineage_wf -t 4 -x fa /home/mirna/05.DAS_tool/results/htn_bins_DASTool_bins DAStools-log_htn -f CheckM-DAS_Tool_bins.txt Vamos a explorar la salida de checkM Primero me puedes decir ¿cuántas lineas tiene tu archivo? Okay… ahora vamos a remover esas lineas feas. sed -e &#39;1,3d&#39; CheckM-DAS_Tool_bins.txt | sed -e &#39;37d&#39; &gt;CheckM-DAS_Tool_bins_mod.txt library(tidyverse) # CheckM -------------------------------------------------------------------#### checkm&lt;-read.table(&quot;CheckM-DAS_Tool_bins_mod.txt&quot;, sep = &quot;&quot;, header = F, na.strings =&quot;&quot;, stringsAsFactors= F) # Extracting good quality bins Megahit ------------------------------------#### colnames(checkm)&lt;-c(&quot;Bin_Id&quot;, &quot;Marker&quot;, &quot;lineage&quot;, &quot;Number_of_genomes&quot;, &quot;Number_of_markers&quot;, &quot;Number_of_marker_sets&quot;, &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;Completeness&quot;, &quot;Contamination&quot;, &quot;Strain_heterogeneity&quot;) good_bins&lt;-checkm %&gt;% select(Bin_Id, Marker, Completeness, Contamination) %&gt;% filter(Completeness &gt;= 50.00) %&gt;% filter(Contamination &lt;= 10.00) Okay… quizá podamos recuperar algunos más. medium_bins&lt;-checkm %&gt;% select(Bin_Id, Marker, Completeness, Contamination) %&gt;% filter(Completeness &gt;= 50.00) %&gt;% filter(Contamination &lt;= 20.00) Muy bien, vamos a extraer esos bins. bins&lt;-medium_bins$Bin_Id write.table(bins, &quot;lista_medium_bins&quot;, quote = F, row.names = F, col.names = F) 7.3.3 Mis Bins mkdir -p 08.Bins/{Genoma,Proteoma} cd 08.Bins sed &#39;s#bin#cp /home/mirna/05.DAS_tool/results/htn_bins_DASTool_bins/bin#g&#39; lista_medium_bins | sed &#39;s#$#.fa .#g&#39; &gt; copy_bins.sh Ahora un ejercicio. grep &quot;&gt;&quot; *.fa Cuál es el problema? change_bin_name&lt;-function(ruta, ambiente){ ruta_original&lt;-getwd() setwd(ruta) filez &lt;- list.files() newname&lt;-paste0(ambiente, &quot;_&quot;, filez) file.rename(from=filez, to=newname) filez &lt;- list.files() file.rename(from=filez, to=sub(pattern=&quot;\\\\.&quot;, replacement=&quot;_&quot;, filez)) setwd(ruta_original) } change_bin_name(&quot;/home/mirna/07.Bins/Genoma&quot;, &quot;htn&quot;) library(phylotools) library(tidyverse) add_names_to_seqs &lt;- function(nombre_del_archivo){ filenames &lt;- unlist(strsplit(nombre_del_archivo, &quot;/&quot;)) filenames &lt;- filenames[[grep(&quot;fa&quot;, filenames)]] divide &lt;- unlist(strsplit(filenames, &quot;\\\\.&quot;)) bin_name &lt;- divide[1] termination &lt;- divide[2] old_name &lt;- get.fasta.name(nombre_del_archivo) new_name &lt;- paste0( bin_name, &quot;-scaffold-&quot;, old_name) ref2 &lt;- data.frame(old_name, new_name) out_file &lt;- paste0(bin_name, &quot;_renamed&quot;, &quot;.&quot;, termination) rename.fasta(infile = nombre_del_archivo, ref_table = ref2, outfile = out_file) } files &lt;- list.files(&quot;.&quot;) files &lt;- paste0(&quot;/home/mirna/07.Bins/Genoma/&quot;, files) map(files, add_names_to_seqs) Veamos si funcionó grep &quot;&gt;&quot; *.fa Muy bien, pongamos eso en una nueva carpeta y esperemos lo mejor jaja, no es cierto, si movámoslo a otra carpeta, pero quitemos el renamed. change_bin_name&lt;-function(ruta){ ruta_original&lt;-getwd() setwd(ruta) filez &lt;- list.files() file.rename(from=filez, to=sub(pattern=&quot;_renamed&quot;, replacement=&quot;&quot;, filez)) setwd(ruta_original) } change_bin_name(&quot;/home/mirna/07.Bins/Genoma/01.Bins_named&quot;) Creen que puedan optimizar esos scripts? discute en tu equipo si tienes una mejor idea! "],["keynote-paquetes-de-bioconductor-relacionados-con-la-metagenómica.html", "8 Keynote: Paquetes de bioconductor relacionados con la metagenómica", " 8 Keynote: Paquetes de bioconductor relacionados con la metagenómica Dra. Yalbi Balderas 02 de agosto de 2022 "],["control-de-calidad-y-ensamble.html", "9 Control de Calidad y Ensamble 9.1 Preprocesamiento", " 9 Control de Calidad y Ensamble M.C. Diana Oaxaca y Dra. Mirna Vazquez Rosas Landa 02 de agosto de 2022 9.1 Preprocesamiento Para hacer la reconstrucción de genomas, fue necesario hacer un preprocesamiento de las lecturas generadas por el secuenciador, este preprocesamiento consistió en los siguientes pasos: Control de calidad: se verificó la calidad de las lecturas con FastQC, este genera reportes que nos permiten verificar el estado de las lecturas, los posibles problemas y qué futuros análisis son necesarios. La limpieza se hizo con TrimGalore, que nos permite eliminar lecturas de baja calidad, adaptadores, etc. bash src/01.qc_preprocessing.sh Ensamble: después de la limpieza de las lecturas se realizó un co-ensamble, se utilizaron todas las lecturas generadas para cada estudio. El ensamble se realizó con Megahit. cp results/01.trimgalore/*/*.fq data/ bash src/change_name_extension.sh bash src/02.assembly.sh Nota: Para las muestras de biogas y sedimento, los autores de los datos depositaron también el co-ensable por lo que este ya no fue generado. Sin embargo, se realizó un filtrado por longitud de los contigs, mediante la herramienta reformat del programa BBtools. ## activar el ambiente de bbmap conda activate /home/dhernandez/.conda/envs/bbmap ## ejecutar reformat reformat.sh in=contigs.fasta out=filtered.fasta minlength=1000 "],["taxonomia.html", "10 Taxonomia 10.1 Leamos los datos", " 10 Taxonomia Dra. Mirna Vazquez Rosas Landa 03 de agosto de 2022 Vamos a explorar la taxonomia de estos bins con GTDB-tk. mkdir 11.GTDBTK Activemos el ambiente conda activate gtdbtk-2.1.0 Indiquemos donde esta la base de datos: export GTDBTK_DATA_PATH=/home/programs/DB/release207_v2 Explora la ayuda de GTDB-tk Discutamos: https://docs.google.com/document/d/1iiw-q-90nATg-RNTd9nU8L1XE5xoDRC6j19JC1GiPIk/edit?usp=sharing Excelente, ahora en equipos vamos a correr GTDB-tk. gtdbtk classify_wf --genome_dir /home/mirna/07.Bins/Genoma/01.Bins_named --out_dir /home/mirna/11.GTDBTK --cpus 4 -x fa Vamos a visualizar los datos. Todos a R!! 10.1 Leamos los datos library(tidyverse) GTDBK&lt;-read.table(&quot;11.GTDBTK/gtdbtk.bac120.summary.tsv&quot;, sep = &quot;\\t&quot;, header = T, na.strings =&quot;&quot;, stringsAsFactors= F)%&gt;% as_tibble() htn_gtdbtk&lt;-GTDBK %&gt;% select(user_genome, classification) %&gt;% separate(classification, c(&quot;Domain&quot;, &quot;Phylum&quot;, &quot;Class&quot;, &quot;Order&quot;, &quot;Family&quot;, &quot;Genus&quot;, &quot;Species&quot;), sep= &quot;;&quot;) %&gt;% rename(Bin_name=user_genome) %&gt;% unite(Bin_name_2, c(&quot;Bin_name&quot;, &quot;Phylum&quot;), remove = FALSE) %&gt;% select(Bin_name, Domain, Phylum, Class, Order, Family, Genus, Species) Parentesis, vamos a imprimir esta tabla para convertirla en metadatos. write.table(htn_gtdbtk, file = &quot;11.GTDBTK/Metadatos.txt&quot;, sep=&quot;\\t&quot;, quote = F, row.names = F, col.names = T) Vamos a hacer un plot GTDBtk&lt;-htn_gtdbtk %&gt;% count(Domain, Phylum) %&gt;% rename(Number_of_MAGs = n) %&gt;% ggplot(aes(x = Domain, y = Number_of_MAGs, fill = Phylum)) + geom_bar(stat = &quot;identity&quot;, position=position_dodge())+ theme_minimal() Puede ser interactivo tambien. library(plotly) GTDBtk_p_fig &lt;- ggplotly(GTDBtk) "],["inferencia-metabólica.html", "11 Inferencia metabólica 11.1 KEEG 11.2 Explorando el metabolismo con rbims. 11.3 Anotacion con InterproScan", " 11 Inferencia metabólica Dra. Mirna Vazquez Rosas Landa 03 de agosto de 2022 Vamos a utilizar prodigal para predecir las proteínas: for i in /home/mirna/07.Bins/Genoma/01.Bins_named/*.fa ; do prodigal -i $i -o $i.txt -a $i.faa ; done Veamos un poco la salida grep &quot;&gt;&quot; *.faa 11.1 KEEG Okay, ahora vamos a utilizar kofam_scan para anotar las proteinas. Vamos a dividirnos en equipos para hacer la anotacion de los bins! Esto es como lo hariamos para uno: /home/programs/DB/kofam/kofam_scan-1.3.0/exec_annotation -o /home/mirna/08.Kofamscan/htn_bins_63.fa.faa.txt /home/mirna/07.Bins/Proteoma/htn_bins_63.fa.faa --report-unannotated --cpu 4 En un loop lo podriamos hacer asi: for i in *.faa ; do /home/programs/DB/kofam/kofam_scan-1.3.0/exec_annotation -o /home/mirna/08.Kofamscan/$i.txt $i --report-unannotated --cpu 4; done Okay antes de correrlo, vamos a crear dos carpetas nuevas y unas ligas simbolicas. mkdir -p 08.Kofamscan/{01.Proteomas,02.KO_results} cd 08.Kofamscan/ ln -s /home/mirna/07.Bins/Proteoma/*.faa 01.Proteomas Ajusta el loop para correr KofamScan con los genomas que te tocan :) 11.2 Explorando el metabolismo con rbims. Vamos a hacer una exploracion rapida del metabolosmo con rbims. Okay iniciamos con la libreria de Rbims library(rbims) Ahora vamos a leer los resulados de KEEG htn&lt;-read_ko(&quot;08.Kofamscan/02.KO_results/&quot;) Vamos a mapear con el resto de la base de datos de KEEG htn_mapp&lt;-mapping_ko(htn) Okay, vamos a enfocarnos en los metabolismos encargados de la obtencion de energia. Overview&lt;-c(&quot;Central Metabolism&quot;, &quot;Carbon Fixation&quot;, &quot;Nitrogen Metabolism&quot;, &quot;Sulfur Metabolism&quot;, &quot;Fermentation&quot;, &quot;Methane Metabolism&quot;) Energy_metabolisms_GOM&lt;-htn_mapp %&gt;% drop_na(Cycle) %&gt;% get_subset_pathway(rbims_pathway, Overview) Vamos a visualizar los datos. plot_bubble(tibble_ko = Energy_metabolisms_GOM, x_axis = Bin_name, y_axis = Pathway_cycle, analysis=&quot;KEGG&quot;, calc=&quot;Percentage&quot;, range_size = c(1,10), y_labs=FALSE, x_labs=FALSE) Okay, incorporemos metadatos, como por ejemplo la taxonomia. Metadatos&lt;-read_delim(&quot;11.GTDBTK/Metadatos.txt&quot;, delim=&quot;\\t&quot;) Hagamos un plot plot_bubble(tibble_ko = Energy_metabolisms_GOM, x_axis = Bin_name, y_axis = Pathway_cycle, analysis=&quot;KEGG&quot;, data_experiment = Metadatos, calc=&quot;Percentage&quot;, color_character = Class, range_size = c(1,10), y_labs=FALSE, x_labs=FALSE) Ahora, vamos a explorar una sola via Methane_metabolisms_GOM&lt;-htn_mapp %&gt;% drop_na(Cycle) %&gt;% get_subset_pathway(Cycle, Methane_meta) Y hagamos un heatmap plot_heatmap(tibble_ko=Methane_metabolisms_GOM, y_axis=Genes, analysis = &quot;KEGG&quot;, calc=&quot;Binary&quot;) Ahora agregemos metadatos plot_heatmap(tibble_ko=Methane_metabolisms_GOM, y_axis=Genes, data_experiment = Metadatos, order_x = Phylum, analysis = &quot;KEGG&quot;, calc=&quot;Binary&quot;) plot_heatmap(tibble_ko=Methane_metabolisms_GOM, y_axis=Genes, data_experiment = Metadatos, #order_y = Pathway_cycle, order_x = Phylum, analysis = &quot;KEGG&quot;, calc=&quot;Binary&quot;) 11.3 Anotacion con InterproScan for i in $(ls *.faa); do sed -i &quot;s/\\*//g&quot; $i; done for i in $(ls *.faa); do interproscan.sh -cpu 4 -goterms -pa -i $i &gt; Log_Interpro_Scan_$i.txt; done Okay… vamos a juntar todo en un solo. cat *.tsv &gt; htn_interpro.tsv Vamos a R library(rbims) library(tidyverse) interpro_pfam_long&lt;-read_interpro( data_interpro = &quot;09.Interpro/01.Proteomas/htn_interpro.tsv&quot;, database=&quot;INTERPRO&quot;, profile = F) interpro_pfam_profile&lt;-read_interpro( data_interpro = &quot;09.Interpro/01.Proteomas/htn_interpro.tsv&quot;, database=&quot;INTERPRO&quot;, profile = T) %&gt;% filter(!str_detect(INTERPRO, &quot;-&quot;)) important_PFAMs&lt;-get_subset_pca(tibble_rbims=interpro_pfam_profile, cos2_val=0.95, analysis=&quot;INTERPRO&quot;) plot_heatmap(important_PFAMs, y_axis=INTERPRO, analysis = &quot;INTERPRO&quot;, distance = T) plot_heatmap(important_PFAMs, y_axis=INTERPRO, analysis = &quot;INTERPRO&quot;, distance = F) "],["mebs.html", "12 MEBs", " 12 MEBs Dra. Valerie de Anda 04 de agosto de 2022 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
